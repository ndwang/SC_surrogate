# ===================================================================
# Training Configuration for Space Charge Surrogate Model
# ===================================================================

# --- Path Configuration ---
paths:
  # Raw data file
  raw_data_path: "data/raw/frequency_maps_10k.npz"
  
  # Directory for processed train/val/test data files
  processed_dir: "data/processed/frequency_maps_10k"
  
  # Directory for saving model checkpoints and scalers
  model_save_dir: "saved_models/frequency_maps_10k"
  
  # Log directory for training outputs
  log_dir: "logs/frequency_maps_10k"

# --- Preprocessing Configuration ---
preprocessing:
  # Train/validation/test split ratios (must sum to 1.0)
  split_ratios: [0.8, 0.1, 0.1]
  
  # Random seed for reproducible data splitting
  split_seed: 42
  
  # Scaler configuration for input and target (options: 'standard', 'symlog', 'asinh')
  # Specify as a dictionary with 'type' and optional parameters:
  input_scaler:
    type: 'standard'   # StandardScaler
  target_scaler:
    type: 'asinh'     # StandardScaler or SymlogScaler or AsinhScaler
  
  # Whether to shuffle data before splitting
  shuffle_data: true
  
  # Memory optimization - process data in chunks if True
  use_chunked_processing: false
  chunk_size: 1000

# --- Model Configuration ---
model:
  # Model architecture type
  architecture: "vae2d"
  
  # Common hyperparameters (used by all architectures)
  kernel_size: 3
  activation: "relu"
  batch_norm: true
  dropout_rate: 0.1
  weight_init: "kaiming_normal"

  # --- VAE2D Architecture Parameters ---
  input_channels: 15
  hidden_channels: [32, 64, 128, 256]
  latent_dim: 64
  input_size: 64
  use_reparameterization: true

  # --- CNN3D Architecture Parameters ---
  # input_channels: 1
  # output_channels: 3
  # hidden_channels: [32, 64, 128, 64, 32]  # Channel progression for encoder/decoder
  # padding: 1

  # --- UNet3D Architecture Parameters ---
  # input_channels: 1
  # output_channels: 3
  # depth: 4
  # initial_features: 32

# --- Dataset Configuration ---
dataset:
  # Dataset type: "space_charge" or "frequency_map"
  type: "frequency_map"  # Options: "space_charge", "frequency_map"
  
  # Filenames for train/val/test splits (relative to processed_dir)
  train_filename: "train.npy"
  val_filename: "val.npy"
  test_filename: "test.npy"

# --- Training Configuration ---
training:
  # Batch size for training
  batch_size: 512
  
  # Number of training epochs
  num_epochs: 100
  
  # Learning rate and optimizer settings
  optimizer: "adamw"
  learning_rate: 3e-4
  weight_decay: 1e-4
  
  # Learning rate scheduler
  scheduler:
    type: "cosine"  # Options: "plateau", "cosine", "step"
    patience: 10
    factor: 0.5
    min_lr: 1e-6
  
  # Loss function
  loss_function:
    type: "beta_vae"
    reconstruction_loss:
      type: "kl_divergence"
      per_channel: true
      normalize: false
    kl_regularization:
      type: "kl_regularization"
      reduction: "mean"
    beta: 0.0
  
  # loss_function: "mse"
  
  # Validation and checkpointing
  validation_frequency: 1  # Validate every N epochs
  save_frequency: 10       # Save checkpoint every N epochs
  early_stopping:
    enabled: false
    patience: 20
    min_delta: 1e-6
  
  # Device configuration
  device: "auto"  # "auto", "cuda", "cpu"
  num_workers: 8  # For DataLoader

  # Resume training options
  resume:
    enabled: false           # If true, attempt to resume training
    checkpoint_path: null    # Optional explicit path to a checkpoint .pth
    use_best: false          # If true, resume from best_model.pth in model_save_dir
    # When both checkpoint_path and use_best are unset/false, no resume is attempted

# --- Evaluation Configuration ---
evaluation:
  # Metrics to compute during evaluation
  metrics: ["mse", "mae", "r2_score", "kl_divergence"]
  
  # Visualization settings
  save_predictions: true
  plot_frequency: 10
  max_plots: 5

# --- Logging Configuration ---
logging:
  # Logging level
  level: "INFO"
  
  # Log file settings
  log_to_file: true
  log_filename: "training.log"
  
  project_name: "space_charge_surrogate"
